<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6f366f4b4">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"><title data-react-helmet="true">How the IOTA Chrysalis Phase 2 Token Migration Works | Chrysalis Documentation</title><meta data-react-helmet="true" property="og:url" content="https://chrysalis.docs.iota.org//guides/migration-mechanism"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How the IOTA Chrysalis Phase 2 Token Migration Works | Chrysalis Documentation"><meta data-react-helmet="true" name="description" content="For the transition to Chrysalis Phase 2, the IOTA Foundation had to develop a way for funds to be migrated to the new"><meta data-react-helmet="true" property="og:description" content="For the transition to Chrysalis Phase 2, the IOTA Foundation had to develop a way for funds to be migrated to the new"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chrysalis.docs.iota.org//guides/migration-mechanism"><link data-react-helmet="true" rel="alternate" href="https://chrysalis.docs.iota.org//guides/migration-mechanism" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chrysalis.docs.iota.org//guides/migration-mechanism" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.76f606ce.css">
<link rel="preload" href="/assets/js/runtime~main.2ea0dcc4.js" as="script">
<link rel="preload" href="/assets/js/main.108d6a98.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/Logo_Swirl_Dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/Logo_Swirl_Dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Chrysalis</b></a><a class="navbar__item navbar__link navbar__link--active" href="/welcome">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/iotaledger/chrysalis-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/welcome">Welcome</a></li><li class="menu__list-item"><a class="menu__link" href="/introduction/what_is_chrysalis">What is Chrysalis?</a></li><li class="menu__list-item"><a class="menu__link" href="/introduction/path_to_chrysalis">Path to Chrysalis</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Firefly</a></li><li class="menu__list-item"><a class="menu__link" href="/node_software">Node Software</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Libraries</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/dev_guide">Developer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/exchange_guide">Exchange</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/token_guide">Token Migration</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/guides/migration-mechanism">Migration Mechanism</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/hub_guide">Hub Migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/backup_security">Backup and Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/guides/snapshot_validation_bootstrapping">Chrysalis Snapshot Validation</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/mainnet">Mainnet</a></li><li class="menu__list-item"><a class="menu__link" href="/devnet">Devnet</a></li><li class="menu__list-item"><a class="menu__link" href="/one-click-private-tangle">Private Tangle</a></li><li class="menu__list-item"><a class="menu__link" href="/rfc">Protocol RFCs</a></li><li class="menu__list-item"><a class="menu__link" href="/resources">Resources</a></li><li class="menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="margin-vert--md tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">How the IOTA Chrysalis Phase 2 Token Migration Works</h1></header><p>For the transition to Chrysalis Phase 2, the IOTA Foundation had to develop a way for funds to be migrated to the new
network. The reason a migration mechanism was necessary was because the previous network no longer supported WOTS addresses.</p><p>The developed mechanism features the following properties:</p><ul><li>It is trustless, meaning that everyone who is interested can verify that migrated funds were legitimate.</li><li>Migrated funds take less than 5 minutes until they become available in the network.</li><li>Migrations take place at any time for the foreseeable future.</li></ul><p>Before we proceed into the developed mechanism, you can view why other mechanisms were not chosen:</p><ul><li><code>Migrating funds by performing periodic global snapshots on both networks</code>: while this approach would have
been the easiest to do, it would have blocked the funds of people between the times of global snapshots. For example, if
we would have taken global snapshots monthly (to carry over funds from burn/migration addresses), token holders would
have been excluded from opportunities arising from the change in token price. In this case, perhaps a user wanted to sell
tokens but were blocked by the fact that the next global snapshot would only be performed in 20 days and so they
couldn&#x27;t move their tokens to an exchange (which only supports Chrysalis Phase 2 IOTA).</li><li><code>Supporting WOTS on Chrysalis Phase 2 (and only allowing to send to non WOTS addresses)</code>: while this was also a
viable option, we decided to not include support for WOTS as it brought a number of legacy problems we did not want includedf:<ul><li>WOTS signatures are very large and make up a disproportional amount of data in a transaction (note that our PoW
requirement in Chrysalis&#x27; Phase 2 was dependent on the size of the message). Additionally, there were no real bounds
on how big such signatures could grow to (even if per default we only supported 3 security levels in our
libraries).</li><li>We would have needed to pollute our new Chrysalis Phase 2 models with support for these addresses and signatures,
adding unnecessary complexity to what should be a clean protocol.</li><li>Chrysalis Phase 2 nodes would have needed to keep a spent address list to inform wallets that they had vulernable
addresses.</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="components"></a>Components<a class="hash-link" href="#components" title="Direct link to heading">#</a></h2><p>The developed migration mechanism was built from following components:</p><ul><li>Chrysalis phase 2 data types (for reference, see <a href="https://github.com/luca-moser/protocol-rfcs/blob/rfc/wotsicide/text/0035-wotsicide/0035-wotsicide.md" target="_blank" rel="noopener noreferrer">the RFC</a> for details):<ul><li><code>Treasury Output</code>: an object which specified an amount of tokens held in the treasury.</li><li><code>Treasury Input</code>: an object which referenced a previous <code>Treasury Output</code>.</li><li><code>Treasury Transaction</code>: an object which defined a <code>Treasury Input</code> referencing the last <code>Treasury Output</code> and a
new <code>Treasury Output</code> that held the delta of what the <code>Treasury Transaction</code> was spending.</li><li><code>Receipt</code>: an object which held a pointer to a legacy milestone index, a list of funds to mint, and
a <code>Treasury Transaction</code>. A <code>Receipt</code> can only be an inner payload of a milestone.</li></ul></li><li>Chrysalis Phase 2 nodes which validated receipts</li><li>Legacy nodes which provided a special API command for the above Chrysalis Phase 2 nodes</li><li><code>Treasury</code>: this was the last <code>Treasury Output</code> in the ledger. There only one existed at any point in time.
After Chrysalis Phase 2 network launched, the <code>Treasury</code> contained the total supply of tokens (2779530283277761) minus the funds which were already migrated during the &quot;7-day-migration-period&quot; prior to the network launch. This means that all funds which are not migrated from the legacy network, always will reside in the <code>Treasury</code>.</li></ul><p>Note, that again, a <code>Receipt</code> could only be contained within a milestone and that valid milestones could only be issued by
the Coordinator, therefore, minting of migrated funds could only happen through milestones and not any other type of
transactions. Likewise, a <code>Treasury Transaction</code> was only valid as an inner payload of a <code>Receipt</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-it-actually-works"></a>How it Actually Works<a class="hash-link" href="#how-it-actually-works" title="Direct link to heading">#</a></h2><ol><li>In essence, a <code>Receipt</code> carried the information about funds which were migrated or &quot;burned&quot; to a <code>migration address</code>
on the legacy network. A <code>migration address</code> looks like any other normal address on the legacy network but it
encapsulates actual information, such as:<ul><li>The target Ed25519 address on the Chrysalis Phase 2 network from which the token holder wants their funds to be
accessible from.</li><li>A checksum of that Ed25519 address.</li><li>A tryte prefix <code>TRANSFER</code> (these addresses always start with this prefix).</li></ul></li><li>As mentioned above, a <code>Receipt</code> could only be contained in a milestone and therefore the Coordinator on the Chrysalis
Phase 2 network:<ol><li>Periodically polled data from a legacy node about what kind of newly confirmed burned/migrated funds there were (while also performing WOTS signature verification on these and the legacy milestone bundle).</li><li>Then a milestone is produced with a <code>Receipt</code> that contained those funds, where within the <code>Receipt</code>,
a <code>Treasury Transaction</code> was placed which deducts the sum of tokens migrated from the <code>Treasury</code>.</li></ol></li><li>Chrysalis Phase 2 nodes then saw receipts when applying milestones and automatically generated outputs for the Ed25519
address as defined in the origin <code>migration address</code> in the legacy network. As an optional step (which is not turned
on by default), every node could have been configured to verify whether the funds in the receipt were really migrated in the
old network using a legacy node and whether all funds for a given legacy milestone index were migrated. If this
verification failed, the node would have automatically panicked as the integrity was no longer correct.</li></ol><p>This meant that:</p><ul><li>The IOTA Foundation could not mint funds out of thin air, because nodes in the Chrysalis Phase 2 network verify that the
funds were burned in the legacy network.</li><li>All migration bundles, respectively transferred to <code>migration addresses</code> which were confirmed by a given legacy
milestone, had to have been migrated fully to the new network, as otherwise the verification failed.</li><li>Node operators were free to choose which legacy nodes they queried with their Chrysalis Phase 2 nodes, so the
verification of migrations/receipts was decentralized. For example, a node operator chooses to both operate their own
legacy and Chrysalis Phase 2 nodes.</li></ul><p>Essentially, via the Firefly wallet, token holders:</p><ol><li>Produced migration bundles which sent funds to <code>migration addresses</code> controlled by the given owner.</li><li>These bundles were confirmed on the legacy network.</li><li>The Chrysalis Phase 2 Coordinator picked these confirmed legacy bundles up and generated receipts minting those funds
to the target Ed25519 address.</li><li>Verifier nodes verified the receipts and made sure that the funds originated from the legacy network.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="verifier-node"></a>Verifier Node<a class="hash-link" href="#verifier-node" title="Direct link to heading">#</a></h3><p>A verifier node was a Chrysalis Phase 2 node which upon seeing receipts:</p><ol><li>Queried a legacy node for the confirmation data for the specified milestone in the receipt.</li><li>Then performed WOTS signature verification of the legacy milestone bundle and all confirmed bundles.</li><li>Additionally it also checked that all confirmed funds on the legacy network for the given legacy milestone, were</li><li>Produce migration bundles which sent funds to <code>migration addresses</code> controlled by the given owner.</li><li>These bundles are confirmed on the legacy network.</li><li>The Chrysalis Phase 2 Coordinator picks these confirmed legacy bundles up and generates receipts minting those funds
to the target Ed25519 address.</li><li>Verifier nodes verify the receipts and make sure that the funds originate from the legacy network.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="verifier-node-1"></a>Verifier Node<a class="hash-link" href="#verifier-node-1" title="Direct link to heading">#</a></h3><p>A verifier node is a Chrysalis Phase 2 node which upon seeing receipts:</p><ol><li>Queries a legacy node for the confirmation data for the specified milestone in the receipt.</li><li>Then performs WOTS signature verification of the legacy milestone bundle and all confirmed bundles.</li><li>Additionally it also checks that all confirmed funds on the legacy network for the given legacy milestone, are
indeed minted with a given batch of receipts (i.e. nothing is left out).</li></ol><p>See <a href="https://hornet.docs.iota.org/post_installation/run_as_verifier.html" target="_blank" rel="noopener noreferrer">Hornet as a verifier node</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/iotaledger/chrysalis-docs/tree/main/docs/guides/migration-mechanism.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/guides/token_guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Chrysalis Migration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/guides/hub_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">IOTA Hub Migration Guide Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#components" class="table-of-contents__link">Components</a></li><li><a href="#how-it-actually-works" class="table-of-contents__link">How it Actually Works</a><ul><li><a href="#verifier-node" class="table-of-contents__link">Verifier Node</a></li><li><a href="#verifier-node-1" class="table-of-contents__link">Verifier Node</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/welcome">Welcome</a></li><li class="footer__item"><a class="footer__link-item" href="/introduction/what_is_chrysalis">What is Chrysalis?</a></li><li class="footer__item"><a class="footer__link-item" href="/introduction/path_to_chrysalis">Path to Chrysalis</a></li><li class="footer__item"><a class="footer__link-item" href="/firefly/">Firefly</a></li><li class="footer__item"><a class="footer__link-item" href="/node_software/">Node Software</a></li><li class="footer__item"><a class="footer__link-item" href="/libraries/">Libraries</a></li><li class="footer__item"><a class="footer__link-item" href="/guides/">Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/mainnet/">Mainnet</a></li><li class="footer__item"><a class="footer__link-item" href="/devnet/">Devnet</a></li><li class="footer__item"><a class="footer__link-item" href="/one-click-private-tangle">Private Tangle</a></li><li class="footer__item"><a class="footer__link-item" href="/rfc">Protocol RFCs</a></li><li class="footer__item"><a class="footer__link-item" href="/resources">Resources</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.iota.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Contribute</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/iotaledger/chrysalis-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 IOTA Foundation, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2ea0dcc4.js"></script>
<script src="/assets/js/main.108d6a98.js"></script>
</body>
</html>